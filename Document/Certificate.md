# 証明書について知る

iOSアプリにおける証明(署名)とは、iOSが信頼できるアプリしかインストールできないようにするための仕組みであり、以下の2点が保証されます。

* 開発者の特定できる
* 開発者が署名してからアプリが改変されていない

<img src="./Images/introduce1.png" width="100%" >

## 全体像

<img src="./Images/overview1.png" width="100%" >

## 詳細

### 1.秘密鍵・公開鍵の作成

秘密鍵・公開鍵とは。。。？

<img src="./Images/description1.png" width="100%" >

公開鍵暗号方式によって、証明書を開発者本人が使用しているかを特定することができます。

<img src="./Images/description2.png" width="100%" >

iOSアプリにおいては以下のように検証されます。

* アプリの開発者は、公開鍵/秘密鍵のペアを用意します
  * 公開鍵はデジタル証明書の形でインストール先のiOSに渡されます
  * 秘密鍵は鍵ペアを生成したマシンに保持され、署名に使われます

* アプリをアーカイブする際、あらかじめ決められた手順でアプリからハッシュ値を計算し、これを秘密鍵で暗号化してアプリに同梱します。このプロセスが署名と呼ばれます。

* アプリをインストールしたiOSは、同じ手順でアプリからハッシュ値を計算します。一方で、アーカイブ時に計算されて暗号化されたハッシュ値は証明書に含まれる開発者の公開鍵で復号します。これら2つの方法で得られたハッシュ値が一致することを確認します。

**暗号化されたハッシュ値が復号できた** → 開発者の特定ができる(暗号化したのは開発者の秘密鍵であり、秘密鍵を持っているのは開発者本人のため)

**ハッシュ値が一致した** → 開発者が署名してからアプリが改変されていない(アプリの内容が変更された場合はハッシュ値が変わって一致しなくなるため)

<img src="./Images/description3.png" width="100%" >

### 2.CSR(証明書署名要求)の送付

CSRは証明書署名リクエストで公開鍵に開発者情報などを付与したものになります。

これを認証局(Apple)に送付することで、Appleから証明書を貰うことができます。

※ CSRは作成時に公開鍵と秘密鍵のペアが生成され、公開鍵はSCRに含まれ、秘密鍵はローカルに保存されます。

<img src="./Images/description4.png" width="100%" >

#### CSR作成方法

1. キーチェンアクセス → 証明書アシスタント → 認証局に証明書を要求

<img src="./Images/description5.png" width="100%" >

2. 証明書情報を入力、ローカルに保存

<img src="./Images/description6.png" width="100%" >

3. 鍵ペア情報入力(2048ビット、RSA選択)

<img src="./Images/description7.png" width="100%" >

### 3.証明書(Certificate)作成

## 参考文献

https://kumaskun.hatenablog.com/entry/2022/09/20/210919